<div class="container-fluid py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="mb-0">
          <i class="bi bi-geo-alt me-2"></i>
          Mis Direcciones
        </h2>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a routerLink="/principal">Inicio</a></li>
            <li class="breadcrumb-item"><a routerLink="/perfil">Mi Perfil</a></li>
            <li class="breadcrumb-item active">Mis Direcciones</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>

  <!-- Descripción -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        Aquí podrás agregar tus direcciones de despacho y/o facturación
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Cargando direcciones...</p>
  </div>

  <!-- Sección de Direcciones -->
  <div *ngIf="!cargando" class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0">Direcciones de despacho</h5>
          <small class="text-muted">
            Ingresa la dirección en la que quieres recibir tu(s) compra(s).
          </small>
        </div>
        <div class="card-body">
          <!-- Grid de Direcciones -->
          <div class="row g-3">
            <!-- Tarjeta: Agregar Dirección -->
            <div class="col-md-6 col-lg-4">
              <div class="direccion-card direccion-card-add" (click)="abrirModalAgregar()">
                <div class="direccion-card-content text-center">
                  <i class="bi bi-plus-circle"></i>
                  <span>Agregar dirección</span>
                </div>
              </div>
            </div>

            <!-- Tarjetas de Direcciones Existentes -->
            <div class="col-md-6 col-lg-4" *ngFor="let direccion of direcciones">
              <div class="direccion-card" [class.direccion-principal]="direccion.esPrincipal">
                <!-- Badge Principal -->
                <div class="badge-principal" *ngIf="direccion.esPrincipal">
                  <i class="bi bi-star-fill me-1"></i>Principal
                </div>

                <!-- Contenido de la Dirección -->
                <div class="direccion-card-header">
                  <h6 class="mb-0">
                    <i class="bi bi-geo-alt-fill me-1"></i>
                    {{ direccion.nombreDireccion }}
                  </h6>
                </div>

                <div class="direccion-card-body">
                  <p class="mb-1">
                    <strong>{{ direccion.nombreReceptor }} {{ direccion.apellidosReceptor }}</strong>
                  </p>
                  <p class="mb-1 text-muted small">
                    {{ direccion.direccion }} {{ direccion.numero }}
                    <span *ngIf="direccion.dptoOficinaCasa">, {{ direccion.dptoOficinaCasa }}</span>
                  </p>
                  <p class="mb-1 text-muted small" *ngIf="direccion.distrito || direccion.provincia">
                    <span *ngIf="direccion.distrito">{{ direccion.distrito }}</span>
                    <span *ngIf="direccion.provincia">, {{ direccion.provincia }}</span>
                    <span *ngIf="direccion.departamento">, {{ direccion.departamento }}</span>
                  </p>
                  <p class="mb-0 text-muted small">
                    <i class="bi bi-telephone me-1"></i>{{ direccion.telefono }}
                  </p>
                </div>

                <!-- Acciones -->
                <div class="direccion-card-footer">
                  <button class="btn btn-sm btn-outline-primary" 
                          (click)="abrirModalEditar(direccion)"
                          title="Editar dirección">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-warning" 
                          *ngIf="!direccion.esPrincipal"
                          (click)="marcarComoPrincipal(direccion.id!)"
                          title="Marcar como principal">
                    <i class="bi bi-star"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" 
                          (click)="confirmarEliminar(direccion)"
                          [disabled]="direccion.esPrincipal && direcciones.length === 1"
                          title="Eliminar dirección">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Sin Direcciones -->
          <div *ngIf="direcciones.length === 0" class="text-center py-5">
            <i class="bi bi-geo-alt" style="font-size: 3rem; color: #6c757d;"></i>
            <h5 class="mt-3">No tienes direcciones registradas</h5>
            <p class="text-muted">Agrega tu primera dirección para recibir tus pedidos</p>
            <button class="btn btn-primary" (click)="abrirModalAgregar()">
              <i class="bi bi-plus-circle me-1"></i>
              Agregar Primera Dirección
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Agregar/Editar Dirección -->
<div class="modal fade" id="modalDireccion" tabindex="-1" aria-labelledby="modalDireccionLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalDireccionLabel">
          {{ esEdicion ? 'Editar Dirección' : 'Agregar Nueva Dirección' }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted small">*Datos obligatorios</p>
        
        <form (ngSubmit)="guardarDireccion()" #direccionForm="ngForm">
          <!-- Nombre de la Dirección -->
          <div class="mb-3">
            <label class="form-label">Nombre de la dirección *</label>
            <input type="text" class="form-control" 
                   [(ngModel)]="direccionEdicion.nombreDireccion" 
                   name="nombreDireccion"
                   placeholder="Ej: Casa, Trabajo, Oficina"
                   required>
          </div>

          <!-- Nombre y Apellidos del Receptor -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Nombre *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="direccionEdicion.nombreReceptor" 
                     name="nombreReceptor"
                     placeholder="Nombre del receptor"
                     required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Apellidos *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="direccionEdicion.apellidosReceptor" 
                     name="apellidosReceptor"
                     placeholder="Apellidos del receptor"
                     required>
            </div>
          </div>

          <!-- Dirección y Número -->
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label">Dirección *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="direccionEdicion.direccion" 
                     name="direccion"
                     placeholder="Ej: Av. Los Conquistadores, Jr. Las Flores"
                     required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Número *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="direccionEdicion.numero" 
                     name="numero"
                     placeholder="Ej: 123"
                     required>
            </div>
          </div>

          <!-- Dpto/Oficina/Casa y Departamento -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Dpto/Oficina/Casa</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="direccionEdicion.dptoOficinaCasa" 
                     name="dptoOficinaCasa"
                     placeholder="Ej: Dpto 101, Oficina 203">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Departamento</label>
              <select class="form-select" 
                      [(ngModel)]="direccionEdicion.departamento" 
                      name="departamento">
                <option value="">Seleccione departamento</option>
                <option value="Lima">Lima</option>
                <option value="Arequipa">Arequipa</option>
                <option value="Cusco">Cusco</option>
                <option value="La Libertad">La Libertad</option>
                <option value="Piura">Piura</option>
                <!-- Agregar más departamentos según necesidad -->
              </select>
            </div>
          </div>

          <!-- Provincia y Distrito -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Provincia</label>
              <select class="form-select" 
                      [(ngModel)]="direccionEdicion.provincia" 
                      name="provincia">
                <option value="">Seleccione provincia</option>
                <option value="Lima">Lima</option>
                <option value="Callao">Callao</option>
                <option value="Huaura">Huaura</option>
                <option value="Cañete">Cañete</option>
                <!-- Agregar más provincias según necesidad -->
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Distrito</label>
              <select class="form-select" 
                      [(ngModel)]="direccionEdicion.distrito" 
                      name="distrito">
                <option value="">Seleccione distrito</option>
                <option value="Miraflores">Miraflores</option>
                <option value="San Isidro">San Isidro</option>
                <option value="Surco">Surco</option>
                <option value="La Molina">La Molina</option>
                <option value="Carabayllo">Carabayllo</option>
                <option value="Los Olivos">Los Olivos</option>
                <option value="San Martin de Porres">San Martin de Porres</option>
                <!-- Agregar más distritos según necesidad -->
              </select>
            </div>
          </div>

          <!-- Teléfono -->
          <div class="mb-3">
            <label class="form-label">Teléfono *</label>
            <div class="input-group">
              <span class="input-group-text">+51</span>
              <input type="text" class="form-control" 
                     [(ngModel)]="direccionEdicion.telefono" 
                     name="telefono"
                     placeholder="993223411"
                     maxlength="9"
                     pattern="9[0-9]{8}"
                     required>
            </div>
            <small class="form-text text-muted">Ingresar 9 dígitos</small>
          </div>

          <!-- Marcar como Principal -->
          <div class="mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" 
                     [(ngModel)]="direccionEdicion.esPrincipal" 
                     name="esPrincipal"
                     id="esPrincipal">
              <label class="form-check-label" for="esPrincipal">
                Marcar como dirección principal
              </label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button type="button" class="btn btn-primary" 
                (click)="guardarDireccion()"
                [disabled]="guardando">
          <span *ngIf="guardando" class="spinner-border spinner-border-sm me-1"></span>
          {{ guardando ? 'Guardando...' : 'Guardar' }}
        </button>
      </div>
    </div>
  </div>
</div>