<div class="container-fluid">
  <!-- Header -->
  <div class="row bg-primary text-white py-3">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h3 class="mb-0">
            <i class="bi bi-people me-2"></i>
            Gestión de Proveedores
          </h3>
          <small>Administrar proveedores y contactos</small>
        </div>
        <div>
          <button class="btn btn-outline-light me-2" (click)="cancelar()">
            <i class="bi bi-arrow-left me-1"></i> Volver
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <!-- Barra de Herramientas -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-3">
                <button class="btn btn-success" 
                        (click)="abrirModalCrear(modalProveedor)">
                  <i class="bi bi-plus-circle me-1"></i>
                  Nuevo Proveedor
                </button>
              </div>
              <div class="col-md-9">
                <div class="row">
                  <div class="col-md-5">
                    <input type="text" class="form-control" 
                           [(ngModel)]="filtroNombre"
                           (input)="aplicarFiltros()"
                           placeholder="Buscar por nombre...">
                  </div>
                  <div class="col-md-5">
                    <input type="text" class="form-control" 
                           [(ngModel)]="filtroMaterial"
                           (input)="aplicarFiltros()"
                           placeholder="Buscar por material...">
                  </div>
                  <div class="col-md-2">
                    <button class="btn btn-outline-secondary w-100" 
                            (click)="limpiarFiltros()">
                      <i class="bi bi-arrow-clockwise"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla de Proveedores -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-light">
            <h5 class="mb-0">
              Lista de Proveedores 
              <span class="badge bg-primary ms-2">{{ proveedoresFiltrados.length }}</span>
            </h5>
          </div>
          <div class="card-body">
            <div *ngIf="cargando" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
              <p class="mt-2">Cargando proveedores...</p>
            </div>

            <div *ngIf="!cargando && proveedoresFiltrados.length === 0" class="text-center py-4">
              <i class="bi bi-inbox" style="font-size: 3rem; color: #6c757d;"></i>
              <p class="mt-2 text-muted">No se encontraron proveedores</p>
            </div>

            <div *ngIf="!cargando && proveedoresFiltrados.length > 0" class="table-responsive">
              <table class="table table-striped table-hover">
                <thead class="table-dark">
                  <tr>
                    <th>Nombre</th>
                    <th>RUC</th>
                    <th>Especialidad</th>
                    <th>Contacto</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>Estado</th>
                    <th width="120">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let proveedor of proveedoresFiltrados">
                    <td>
                      <strong>{{ proveedor.nombre }}</strong>
                      <br>
                      <small class="text-muted">{{ proveedor.direccion }}</small>
                    </td>
                    <td>{{ proveedor.ruc || 'No registrado' }}</td>
                    <td>
                      <span class="badge bg-info">{{ proveedor.materialEspecialidad }}</span>
                    </td>
                    <td>{{ proveedor.contacto || 'No especificado' }}</td>
                    <td>{{ proveedor.telefono || 'No registrado' }}</td>
                    <td>
                      <small>{{ proveedor.email || 'No registrado' }}</small>
                    </td>
                    <td>
                      <span *ngIf="proveedor.activo" class="badge bg-success">Activo</span>
                      <span *ngIf="!proveedor.activo" class="badge bg-danger">Inactivo</span>
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" 
                                (click)="abrirModalEditar(modalProveedor, proveedor)"
                                title="Editar">
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-outline-danger" 
                                (click)="abrirModalEliminar(modalEliminar, proveedor)"
                                title="Eliminar">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Crear/Editar Proveedor -->
<ng-template #modalProveedor let-modal>
  <div class="modal-header">
    <h5 class="modal-title">
      <i class="bi bi-people me-2"></i>
      {{ esEdicion ? 'Editar Proveedor' : 'Nuevo Proveedor' }}
    </h5>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form (ngSubmit)="guardarProveedor()">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Nombre del Proveedor *</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="proveedorEdicion.nombre" 
                 name="nombre" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">RUC</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="proveedorEdicion.ruc" 
                 name="ruc" maxlength="11"
                 placeholder="11 dígitos">
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Especialidad de Material *</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="proveedorEdicion.materialEspecialidad" 
                 name="materialEspecialidad" required
                 placeholder="Ej: Madera Pino, Plástico, Colchones">
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Persona de Contacto</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="proveedorEdicion.contacto" 
                 name="contacto"
                 placeholder="Nombre del contacto principal">
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Teléfono</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="proveedorEdicion.telefono" 
                 name="telefono" maxlength="9"
                 placeholder="9XXXXXXXX">
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" 
                 [(ngModel)]="proveedorEdicion.email" 
                 name="email"
                 placeholder="proveedor@ejemplo.com">
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Dirección</label>
        <textarea class="form-control" 
                  [(ngModel)]="proveedorEdicion.direccion" 
                  name="direccion" rows="2"
                  placeholder="Dirección completa del proveedor"></textarea>
      </div>

      <div class="mb-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" 
                 [(ngModel)]="proveedorEdicion.activo" 
                 name="activo" id="activo">
          <label class="form-check-label" for="activo">
            Proveedor activo
          </label>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      Cancelar
    </button>
    <button type="button" class="btn btn-primary" 
            (click)="guardarProveedor()" [disabled]="cargando">
      <span *ngIf="cargando" class="spinner-border spinner-border-sm me-1"></span>
      {{ esEdicion ? 'Actualizar' : 'Crear' }} Proveedor
    </button>
  </div>
</ng-template>

<!-- Modal de Confirmación para Eliminar -->
<ng-template #modalEliminar let-modal>
  <div class="modal-header">
    <h5 class="modal-title text-danger">
      <i class="bi bi-exclamation-triangle me-2"></i>
      Confirmar Eliminación
    </h5>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <p>¿Estás seguro de que deseas eliminar al proveedor?</p>
    <div class="alert alert-warning">
      <strong>{{ proveedorEdicion.nombre }}</strong><br>
      <small>Especialidad: {{ proveedorEdicion.materialEspecialidad }}</small>
    </div>
    <p class="text-muted small">
      <i class="bi bi-info-circle me-1"></i>
      El proveedor se marcará como inactivo y no aparecerá en las listas de selección.
    </p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      Cancelar
    </button>
    <button type="button" class="btn btn-danger" 
            (click)="eliminarProveedor()" [disabled]="cargando">
      <span *ngIf="cargando" class="spinner-border spinner-border-sm me-1"></span>
      Eliminar Proveedor
    </button>
  </div>
</ng-template>